# Question 10 - Coupon Collector    

## Each box of some product contains 1 random coupon. If there are $m$ different types of coupons, what is the expected number of boxes that need to be opened before you collect one of each coupon? 

### Context  
The coupon collector problem is a famous problem in probability theory. It is covered in most "intro to probability" courses at the university level and is near ubiquitous at technical interviews involving probability. When I first encountered this problem a few years ago, I found the given solution to be pretty convoluted, so this is my attempt at making it cleaner and more intuitive. 

### Solution  
Let's set a few ground rules before we begin. Most importantly, the process is a "sequential series of *independent* (but not identical) memoryless waiting times". That statement is really important and should be grasped clearly, so I'll go word-by-word.   

It is a "*sequential series*" since the process can be split into stages (stage 0, where 0 coupons have been collected, stage 1, where 1 has been collected, and so on).  

"*Independence*" means that the waiting time in some stage $n$ is independent of the waiting times in other stages (technically, this doesn't change the math for the expectation, but does for things like variance).   

The random variables (waiting times) are "*non-identical*", which simply means that the waiting time for the 1st coupon is not the same as the waiting time for all other coupons. This is kinda obvious, the waiting time to get the first coupon is 1, the waiting time to get the 50th coupon is way higher. 

Finally, each stage is "*memoryless*". This means that at some stage $m$, the chance of getting the next coupon from the next box is the same regardless of the number of past failures. 

It is also important to note that the coupons are not preemptively labeled in this setup. That means stage $n$ simply deals with finding the n-th unique coupon, not finding some specific coupon that has been labelled "number n". In more concrete terms, this means that stage 1 adresses the number of boxes that needs to be opened to find the first coupon (so that's just 1, since any box will yield a new coupon if no coupons have yet been found), and stage 2 adresses the number of boxes that needs to be opened to find the second coupon (ie. a new coupon that is *different* from the one found in stage 1, but no other label attached to it).  

The memorylessness of each stage means that each stage can be modeled as a geometric random variable, as the geometric random variable is the only discrete RV that is memoryless. So the general process to get the total expected time until absorption (all coupons found) would be to determine the expectation of each stage, and then sum them all up (as the expectation is linear, regardless of whether or not the process is independent).

Let $p_{n}$ be the probability of finding the n-th new coupon from the next box. Let $E_{n}$ be the expected time (number of boxes opened) to absorption for stage $n$ (ie. finding the n-th new coupon). As each step is a geometric random variable (with the success condition being unboxing a new coupon):

$$
E_{n} = \frac{1}{p_{n}}
$$

We will then sum up all the individual expectations for $n = 1, 2, ..., m$ to get the total expected time until all coupons have been collected. 

So, what is $p_{n}$? For starters, $p_{1} = 1$, as it is guaranteed to get a unique coupon from the next box if no coupons have yet been collected, moving us to stage 2. For the next stage, the odds of the coupon being unique (ie. not the same one as the one found in the first stage) is: 

$$
p_{2} = \frac{m-1}{m} \quad \text{consequently:} \quad E_{2} = \frac{m}{m-1}
$$

The $m-1$ basically accounts for the number of coupons already found (1, for now), as pulling the previously-found coupon would be considered a failure by the geometric RV we're using. Likewise, after two unique coupons have been found, the odds of success will decrease to the ratio of the number of unfound coupons left (m-2) and the total number of coupons (m). To illustrate:

$$
p_{3} = \frac{m-2}{m} \quad p_{4} = \frac{m-3}{m} \quad p_{5} = \frac{m-4}{m}
$$

So a general formula for the probability of success at some stage $n$ can be written as:

$$
p_{n} = \frac{m-n+1}{m}
$$

And consequently, the expectated time to absorption at state $n$ is simply the reciprocal:

$$
E_{n} = \frac{m}{m-n+1}
$$

To get the time until all coupons have been found, we simply sum up all the expectations from stage 1 to stage m:

$$
E = E_{1} + E_{2} + ... + E_{m} \\\\
$$

$$
\therefore \quad E = \sum_{n=1}^{m} \frac{m}{m-n+1} = \frac{m}{m} + \frac{m}{m-1} + \frac{m}{m-2} + ... + \frac{m}{1} = m \left( \frac{1}{m} + \frac{1}{m-1} + ... + \frac{1}{2} + \frac{1}{1} \right) = m \left( \frac{1}{1} + \frac{1}{2} + ... + \frac{1}{m-1} + \frac{1}{m} \right)
$$

That's pretty much it... the total expected number of boxes that need to be opened before all coupons are collected is $m$ times the sum of the harmonic series up to $m$ (represented as $H_{m}$), or formally:

$$
\large E = mH_{m}
$$
